<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Saskatchewan Grain Exporter - Logistics</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Application Structure Plan: 
        The SPA uses a top tab-based navigation ("Contact", "Products", "Quality", "Logistics", "Regulations", "Detailed Description") to switch content in the main view. 
        The "Logistics" tab, set as default, activates a left sidebar detailing the 12-step shipment process. Clicking sidebar items highlights them.
        A Gemini API feature is added to the Logistics tab to analyze shipment risks and suggest solutions.
        This structure was chosen for its clarity and direct mapping to the report's sections, allowing users to easily navigate to specific areas of interest. 
        The sidebar for "Logistics" provides a granular view of that complex process, enhancing usability.
        Key interactions include tab switching, sidebar item selection, and triggering the Gemini API analysis.
    -->
    <!-- Visualization & Content Choices:
        - Report Info: Section 1.2.3 - Table: Typical Quality Specifications by Grain Type
          - Goal: Compare quality metrics.
          - Viz/Presentation Method: HTML Table + Chart.js Bar Chart comparing 'Min. Protein Content' for CWRS Wheat & Durum.
          - Interaction: Chart tooltips.
          - Justification: Visual comparison for key metrics.
          - Library/Method: Chart.js.
        - Report Info: Section 1.2.5 - Table: Key Canadian Export Documentation for Grain
          - Goal: Inform about required documents.
          - Viz/Presentation Method: HTML Table.
          - Interaction: None.
          - Justification: Clear factual presentation.
          - Library/Method: HTML/Tailwind.
        - Report Info: Section 3.3.2 - Table: Comparative Analysis: Container vs. Bulk Shipping
          - Goal: Compare shipping methods.
          - Viz/Presentation Method: HTML Table.
          - Interaction: None.
          - Justification: Clear side-by-side comparison.
          - Library/Method: HTML/Tailwind.
        - Report Info: Section 2.2 - Logistics Sidebar Menu Items
          - Goal: Navigate logistics process.
          - Viz/Presentation Method: Clickable list in sidebar.
          - Interaction: Highlight on click.
          - Justification: Standard for multi-step processes.
          - Library/Method: HTML/Tailwind/JS.
        - Gemini API Integration (Logistics Tab):
          - Goal: Provide dynamic risk analysis and solution suggestions for grain shipment.
          - Viz/Presentation Method: Button triggers API call, response displayed in a designated area.
          - Interaction: User clicks button to get AI-generated insights.
          - Justification: Enhances static content with dynamic, AI-powered analysis.
          - Library/Method: Fetch API to Gemini (gemini-2.0-flash).
        - Textual Content: All other sections.
          - Goal: Inform.
          - Viz/Presentation Method: Dynamically shown/hidden text blocks.
          - Interaction: Navigation via tabs/sidebar.
          - Justification: Standard SPA content display.
          - Library/Method: HTML/Tailwind/JS.
        - Farm Image (Section 3.2):
          - Goal: Visual identity for Logistics page.
          - Viz/Presentation Method: Image tag with placeholder.
          - Interaction: None.
          - Justification: As per report.
          - Library/Method: HTML.
    -->
    <style>
        body {
            font-family: 'Inter', sans-serif; 
            background-color: #F8F9FA; 
        }
        .tab-active {
            background-color: #FFD700; /* Gold */
            color: #8B4513; /* Saddle Brown */
            border-bottom-width: 4px;
            border-color: #8B4513; /* Saddle Brown */
        }
        .sidebar-item-active {
            background-color: #006400; /* Deep Green */
            color: #FFFFFF; /* White */
        }
        .sidebar-item:hover {
            background-color: #F5DEB3; /* Wheat */
            color: #8B4513; /* Saddle Brown */
        }
        .tab-inactive {
            background-color: #F5DEB3; /* Wheat */
            color: #8B4513; /* Saddle Brown */
        }
        .tab-inactive:hover {
            background-color: #FFE082; /* Lighter Gold */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px; 
            margin-left: auto;
            margin-right: auto;
            height: 300px; 
            max-height: 350px; 
        }
        @media (min-width: 768px) { 
            .chart-container {
                height: 350px;
            }
        }
        #logistics-sidebar-content::-webkit-scrollbar {
            width: 8px;
        }
        #logistics-sidebar-content::-webkit-scrollbar-track {
            background: #F5DEB3; 
        }
        #logistics-sidebar-content::-webkit-scrollbar-thumb {
            background: #8B4513; 
            border-radius: 4px;
        }
        #logistics-sidebar-content::-webkit-scrollbar-thumb:hover {
            background: #A0522D; 
        }
        .table-header {
            background-color: #A0522D; 
            color: #FFFFFF; 
        }
        .table-row-even {
            background-color: #FFF8E1; 
        }
        .table-row-odd {
            background-color: #F5DEB3; 
        }
        .gemini-button {
            background-color: #006400; /* Deep Green */
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem; /* rounded-md */
            font-weight: 500; /* medium */
            transition: background-color 0.3s;
        }
        .gemini-button:hover {
            background-color: #007500; /* Slightly Lighter Deep Green */
        }
        .loading-spinner {
            border: 4px solid #f3f3f3; /* Light grey */
            border-top: 4px solid #8B4513; /* Saddle Brown */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin-right: 8px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-[#F8F9FA] text-[#333333]">

    <nav class="bg-[#F5DEB3] shadow-md sticky top-0 z-50">
        <div class="max-w-full mx-auto px-0 sm:px-0 lg:px-0">
            <div class="flex items-center justify-center h-16">
                <div class="flex items-center">
                    <div class="flex space-x-1">
                        <button data-tab="logistics" class="top-tab px-3 py-2 rounded-md text-sm font-medium tab-inactive">Logistics</button>
                        <button data-tab="products" class="top-tab px-3 py-2 rounded-md text-sm font-medium tab-inactive">Products</button>
                        <button data-tab="quality" class="top-tab px-3 py-2 rounded-md text-sm font-medium tab-inactive">Quality</button>
                        <button data-tab="regulations" class="top-tab px-3 py-2 rounded-md text-sm font-medium tab-inactive">Regulations</button>
                        <button data-tab="description" class="top-tab px-3 py-2 rounded-md text-sm font-medium tab-inactive">Detailed Description</button>
                        <button data-tab="contact" class="top-tab px-3 py-2 rounded-md text-sm font-medium tab-inactive">Contact</button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <div id="main-content-wrapper" class="flex flex-col md:flex-row">
            <aside id="logistics-sidebar" class="w-full md:w-1/4 bg-[#F5DEB3] p-4 rounded-lg shadow-lg md:mr-4 mb-4 md:mb-0 hidden">
                <h2 id="logistics-sidebar-title" class="text-xl font-bold text-[#8B4513] mb-3 pb-2 border-b-2 border-[#8B4513]">Logistics Steps</h2>
                <div id="logistics-sidebar-content" class="space-y-1 overflow-y-auto max-h-[calc(100vh-200px)]">
                </div>
            </aside>

            <main id="page-content" class="w-full md:w-3/4 bg-white p-6 rounded-lg shadow-lg">
                
                <section id="logistics-content" class="tab-content space-y-6">
                    <div class="prose max-w-none">
                        <h1 class="text-3xl font-bold text-[#8B4513]">Navigating Global Grain Shipments</h1>
                        <p class="text-lg text-[#A0522D] leading-relaxed">
                            This section details the comprehensive logistics involved in exporting grain from our Saskatchewan farm to international markets like the Philippines. We manage a complex supply chain, ensuring timely and quality delivery through meticulous planning and strong partnerships. Explore the journey of our grains, from prairie fields to your port.
                        </p>
                    </div>
                    <div class="flex flex-col md:flex-row gap-6 items-start">
                        <div class="w-full md:w-1/2">
                            <img src="https://placehold.co/800x500/F5DEB3/8B4513?text=Prairie+Grain+Logistics+Inc." alt="Saskatchewan Farm Operations" class="rounded-lg shadow-md w-full h-auto object-cover">
                        </div>
                        <div class="w-full md:w-1/2 space-y-3">
                            <h3 class="text-xl font-semibold text-[#006400]">Prairie Grain Logistics Inc.</h3>
                            <p><strong class="text-[#8B4513]">Location:</strong> Near Swift Current, Saskatchewan, Canada</p>
                            <p><strong class="text-[#8B4513]">Telephone:</strong> +1 (306) 555-GRAIN</p>
                            <p><strong class="text-[#8B4513]">Email:</strong> info@prairiegrainlogistics.ca</p>
                            <p><strong class="text-[#8B4513]">Website:</strong> <a href="#" class="text-sky-600 hover:text-sky-800">www.prairiegrainlogistics.ca</a></p>
                        </div>
                    </div>
                    <h2 class="text-2xl font-semibold text-[#8B4513] mt-6">The Journey: Saskatchewan to the Philippines</h2>
                    <p>Shipping grain from the landlocked province of Saskatchewan to an archipelago nation like the Philippines is a multi-stage logistical endeavor. The initial leg involves moving the grain from the farm or a local grain elevator via rail (the preferred mode for long distances) or truck to a major Western Canadian port, typically Vancouver. Vancouver serves as a key hub with transloading facilities where grain can be transferred from railcars into shipping containers or directly onto bulk vessels.</p>
                    
                    <div class="mt-6">
                        <button id="analyzeShipmentButton" class="gemini-button flex items-center justify-center">
                            âœ¨ Analyze Shipment Risks & Suggest Solutions
                        </button>
                        <div id="geminiLogisticsAnalysisLoading" class="mt-3 hidden flex items-center text-[#8B4513]">
                            <div class="loading-spinner"></div>
                            Analyzing risks and solutions...
                        </div>
                        <div id="geminiLogisticsAnalysisResult" class="mt-4 p-4 bg-[#FFF8E1] rounded-lg shadow text-[#A0522D] prose max-w-none"></div>
                    </div>
                    
                    <h3 class="text-xl font-semibold text-[#8B4513] mt-4">Port Operations and Ocean Freight</h3>
                    <p>At the port, the choice between container shipping and bulk vessel transport is critical. Containers offer flexibility, while bulk vessels are more cost-effective for very large volumes. Canadian Food Inspection Agency (CFIA) inspections are conducted at the port or terminal to ensure compliance with export standards. Following successful loading and clearance, the grain commences its long ocean voyage to the Philippines.</p>

                    <h3 class="text-xl font-semibold text-[#8B4513] mt-4">Comparative Analysis: Container vs. Bulk Shipping</h3>
                    <div class="overflow-x-auto">
                        <table id="logistics-comparison-table" class="min-w-full divide-y divide-gray-300 shadow-sm rounded-lg">
                            <thead class="table-header">
                                <tr>
                                    <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider">Feature</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider">Container Shipping</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider">Bulk Vessel Shipping</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                            </tbody>
                        </table>
                    </div>

                    <h3 class="text-xl font-semibold text-[#8B4513] mt-4">Challenges in Canada-Philippines Grain Shipments</h3>
                    <ul class="list-disc list-inside space-y-1 text-[#A0522D]">
                        <li><strong>Logistical Complexity and Cost:</strong> Vast distances and multiple transport modes.</li>
                        <li><strong>Product Integrity:</strong> Susceptibility to degradation during long transit.</li>
                        <li><strong>Regulatory and Market Factors:</strong> Meeting Canadian and Philippine regulations, market price volatility.</li>
                    </ul>

                    <h3 class="text-xl font-semibold text-[#8B4513] mt-4">Methods and Solutions Employed</h3>
                     <ul class="list-disc list-inside space-y-1 text-[#A0522D]">
                        <li>Strong Logistical Partnerships</li>
                        <li>Documentation Expertise</li>
                        <li>Advanced Planning</li>
                        <li>Rigorous Quality Control</li>
                        <li>Appropriate Packaging (e.g., liner bags)</li>
                        <li>Comprehensive Insurance</li>
                    </ul>
                    <p class="mt-2">The ability to consistently overcome these multifaceted challenges is a hallmark of a sophisticated and reliable international grain exporter. This journey demands not only agricultural expertise but also a high degree of logistical orchestration, diligent risk management, and an unwavering commitment to quality.</p>
                </section>

                <section id="products-content" class="tab-content hidden space-y-4">
                    <div class="prose max-w-none">
                        <h1 class="text-3xl font-bold text-[#8B4513]">Our Premium Grains</h1>
                        <p class="text-lg text-[#A0522D] leading-relaxed">
                            We offer a diverse range of high-quality grains cultivated in the fertile lands of Saskatchewan. Each product is grown and handled with care to meet stringent international standards. Discover the characteristics and uses of our primary export grains.
                        </p>
                    </div>
                    <div id="products-list" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    </div>
                </section>

                <section id="quality-content" class="tab-content hidden space-y-6">
                    <div class="prose max-w-none">
                        <h1 class="text-3xl font-bold text-[#8B4513]">Commitment to Quality</h1>
                         <p class="text-lg text-[#A0522D] leading-relaxed">
                            Quality assurance is paramount in our operations. From seed to shipment, we implement rigorous quality control processes and adhere to Canadian Grain Commission standards. This section details our quality management, key indicators, certifications, and typical specifications for our grains.
                        </p>
                    </div>
                    <p>Our quality management includes adherence to official grading standards by the Canadian Grain Commission and compliance with Safe Food for Canadians Regulations (SFCR). We focus on key indicators like test weight, protein content, and moisture levels.</p>
                    <h3 class="text-xl font-semibold text-[#8B4513] mt-4">Typical Quality Specifications by Grain Type</h3>
                    <div class="overflow-x-auto mb-4">
                        <table id="quality-specs-table" class="min-w-full divide-y divide-gray-300 shadow-sm rounded-lg">
                            <thead class="table-header">
                                <tr>
                                    <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider">Grain Type</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider">Key Parameter</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider">Target Range / Grade Standard</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                            </tbody>
                        </table>
                    </div>
                    <h3 class="text-xl font-semibold text-[#8B4513] mt-4">Protein Content Comparison (Wheat)</h3>
                    <div class="chart-container bg-white p-4 rounded-lg shadow">
                        <canvas id="qualityChart"></canvas>
                    </div>
                </section>

                <section id="regulations-content" class="tab-content hidden space-y-4">
                     <div class="prose max-w-none">
                        <h1 class="text-3xl font-bold text-[#8B4513]">Regulatory Compliance</h1>
                        <p class="text-lg text-[#A0522D] leading-relaxed">
                            We operate in full compliance with Canadian and international regulations governing grain exports. This section outlines key frameworks like the Canada Grain Act, CFIA oversight, and essential export documentation, ensuring transparency and trust in our trading practices.
                        </p>
                    </div>
                    <p>We adhere to the Canada Grain Act, CFIA oversight for export licenses and phytosanitary certificates, and the Safe Food for Canadians Regulations (SFCR).</p>
                    <h3 class="text-xl font-semibold text-[#8B4513] mt-4">Key Canadian Export Documentation for Grain</h3>
                    <div class="overflow-x-auto">
                        <table id="export-docs-table" class="min-w-full divide-y divide-gray-300 shadow-sm rounded-lg">
                            <thead class="table-header">
                                <tr>
                                    <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider">Document Type</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider">Purpose/Requirement</th>
                                    <th class="px-4 py-2 text-left text-xs font-medium uppercase tracking-wider">Issuing Body/Responsibility</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-200">
                            </tbody>
                        </table>
                    </div>
                </section>

                <section id="description-content" class="tab-content hidden space-y-4">
                    <div class="prose max-w-none">
                        <h1 class="text-3xl font-bold text-[#8B4513]">Our Farm: Heritage and Vision</h1>
                        <p class="text-lg text-[#A0522D] leading-relaxed">
                            Learn more about Prairie Grain Logistics Inc., our history, mission, and operational scale in Saskatchewan. We are committed to sustainable agriculture and leveraging our expertise to connect Canadian grains with the world.
                        </p>
                        <h3 class="text-xl font-semibold text-[#8B4513] mt-4">Our Story</h3>
                        <p>Founded on principles of integrity and excellence, Prairie Grain Logistics Inc. has grown from a local farm to an international exporter. We are dedicated to providing high-quality Canadian grains to the global market.</p>
                        <h3 class="text-xl font-semibold text-[#8B4513] mt-4">Operations and Scale</h3>
                        <p>Our operations span significant acreage in Saskatchewan, focusing on primary crops like wheat, canola, barley, and lentils. We utilize modern on-farm storage and handling equipment to maintain product quality.</p>
                        <h3 class="text-xl font-semibold text-[#8B4513] mt-4">Sustainability Practices</h3>
                        <p>We are committed to sustainable farming practices and environmental stewardship, ensuring the long-term health of our land and the quality of our products.</p>
                    </div>
                </section>

                <section id="contact-content" class="tab-content hidden space-y-4">
                    <div class="prose max-w-none">
                         <h1 class="text-3xl font-bold text-[#8B4513]">Get In Touch</h1>
                        <p class="text-lg text-[#A0522D] leading-relaxed">
                            We welcome inquiries from potential buyers, partners, and stakeholders. Use the information below to connect with us, or fill out our contact form for a prompt response.
                        </p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h3 class="text-xl font-semibold text-[#006400]">Contact Information</h3>
                            <p class="mt-2"><strong class="text-[#8B4513]">Business Name:</strong> Prairie Grain Logistics Inc.</p>
                            <p><strong class="text-[#8B4513]">Phone:</strong> +1 (306) 555-GRAIN (555-4724)</p>
                            <p><strong class="text-[#8B4513]">Email:</strong> info@prairiegrainlogistics.ca</p>
                            <p><strong class="text-[#8B4513]">Physical Address:</strong> 123 Prairie View Road, Swift Current, Saskatchewan, S9H 0A1, Canada</p>
                            <p><strong class="text-[#8B4513]">Hours of Operation:</strong> Monday - Friday, 8:00 AM - 5:00 PM (CST)</p>
                            <div class="mt-4">
                                <h4 class="text-md font-semibold text-[#8B4513]">Find Us:</h4>
                                <div class="aspect-w-16 aspect-h-9 mt-2 rounded-lg shadow">
                                     <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d162734.6890087894!2d-107.93373940401267!3d50.28805090594088!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x5313a3e529ef9905%3A0x3f1545ebb00fcee0!2sSwift%20Current%2C%20SK!5e0!3m2!1sen!2sca!4v1684781209871!5m2!1sen!2sca" width="100%" height="300" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade" class="rounded-lg"></iframe>
                                </div>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold text-[#006400]">Send Us a Message</h3>
                            <form id="contactForm" class="mt-2 space-y-3">
                                <div>
                                    <label for="name" class="block text-sm font-medium text-[#8B4513]">Full Name</label>
                                    <input type="text" name="name" id="name" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#006400] focus:border-[#006400] sm:text-sm bg-white">
                                </div>
                                <div>
                                    <label for="email" class="block text-sm font-medium text-[#8B4513]">Email Address</label>
                                    <input type="email" name="email" id="email" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#006400] focus:border-[#006400] sm:text-sm bg-white">
                                </div>
                                <div>
                                    <label for="subject" class="block text-sm font-medium text-[#8B4513]">Subject</label>
                                    <input type="text" name="subject" id="subject" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#006400] focus:border-[#006400] sm:text-sm bg-white">
                                </div>
                                <div>
                                    <label for="message" class="block text-sm font-medium text-[#8B4513]">Message</label>
                                    <textarea id="message" name="message" rows="4" required class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-[#006400] focus:border-[#006400] sm:text-sm bg-white"></textarea>
                                </div>
                                <div>
                                    <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-[#006400] hover:bg-[#007500] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#006400]">
                                        Send Message
                                    </button>
                                </div>
                            </form>
                            <div id="form-feedback" class="mt-3 text-sm"></div>
                        </div>
                    </div>
                </section>

            </main>
        </div>
    </div>

    <script>
        const logisticsSidebar = document.getElementById('logistics-sidebar');
        const logisticsSidebarContent = document.getElementById('logistics-sidebar-content');
        const logisticsSidebarTitle = document.getElementById('logistics-sidebar-title');
        const tabs = document.querySelectorAll('.top-tab');
        const tabContents = document.querySelectorAll('.tab-content');
        let qualityChartInstance = null;

        const analyzeShipmentButton = document.getElementById('analyzeShipmentButton');
        const geminiLoadingDiv = document.getElementById('geminiLogisticsAnalysisLoading');
        const geminiResultDiv = document.getElementById('geminiLogisticsAnalysisResult');


        const logisticsSteps = [
            { id: "step1", title: "Market & Buyer Identification", description: "Identifying target international markets and buyers." },
            { id: "step2", title: "Contract & Agreement", description: "Finalizing sales contracts and terms." },
            { id: "step3", title: "Sourcing & Accumulation", description: "Gathering the required volume of grain." },
            { id: "step4", title: "Pre-Shipment Preparations", description: "Grain cleaning, grading, drying, and storage." },
            { id: "step5", title: "Domestic Transportation to Port", description: "Inland transport (rail/truck) to export terminal." },
            { id: "step6", title: "Transloading & Port Handling", description: "Transferring grain at the port." },
            { id: "step7", title: "Export Documentation & Permits", description: "Securing all necessary Canadian export permits." },
            { id: "step8", title: "Vessel Booking & Preparation", description: "Booking space on an ocean vessel." },
            { id: "step9", title: "Loading & Pre-Shipment Inspection", description: "Supervising loading, visual inspections." },
            { id: "step10", title: "Ocean Freight & In-Transit Care", description: "Managing the ocean voyage and cargo quality." },
            { id: "step11", title: "Arrival & Discharge at Destination", description: "Customs clearance and cargo discharge." },
            { id: "step12", title: "Final Delivery & Post-Discharge", description: "Inland transport to buyer's facility." }
        ];

        const productsData = [
            { name: "Canada Western Red Spring (CWRS) Wheat", description: "High protein wheat, excellent for milling and baking.", image: "https://placehold.co/400x250/F5DEB3/8B4513?text=CWRS+Wheat" },
            { name: "Canada Durum Wheat", description: "Ideal for pasta and couscous production due to its hardness and high protein.", image: "https://placehold.co/400x250/F5DEB3/8B4513?text=Durum+Wheat" },
            { name: "Canola", description: "High-quality oilseed used for edible oil and animal feed.", image: "https://placehold.co/400x250/F5DEB3/8B4513?text=Canola" },
            { name: "Barley", description: "Versatile grain used for malting, animal feed, and food products.", image: "https://placehold.co/400x250/F5DEB3/8B4513?text=Barley" }
        ];

        const qualitySpecsData = [
            { grain: "No. 1 CWRS Wheat", parameter: "Protein Content (dry basis)", target: "Min. 13.5%" },
            { grain: "No. 1 CWRS Wheat", parameter: "Moisture Content", target: "Max. 14.0% - 14.5%" },
            { grain: "No. 1 CWRS Wheat", parameter: "Test Weight (kg/hL)", target: "Min. 77.5" },
            { grain: "No. 1 Canada Durum", parameter: "Protein Content (dry basis)", target: "Min. 12.5%" },
            { grain: "No. 1 Canada Durum", parameter: "Moisture Content", target: "Max. 14.5%" },
            { grain: "No. 1 Canada Durum", parameter: "Vitreous Kernels", target: "Min. 80%" },
            { grain: "No. 1 Canada Canola", parameter: "Oil Content (dry basis)", target: "Min. 42% (typical)" },
            { grain: "No. 1 Canada Canola", parameter: "Moisture Content", target: "Max. 10.0%" },
        ];
        
        const exportDocsData = [
            { type: "CFIA Export Licence/Registration", purpose: "Required for businesses needing CFIA export certificates.", issuing: "CFIA" },
            { type: "Preventive Control Plan (PCP)", purpose: "Demonstrates control of food safety hazards.", issuing: "Exporter / CFIA oversight" },
            { type: "Phytosanitary Certificate", purpose: "Attests grain is free of quarantine pests.", issuing: "CFIA" },
            { type: "Certificate of Origin", purpose: "Certifies country of origin for customs.", issuing: "Chambers of Commerce / Exporter" },
            { type: "Bill of Lading", purpose: "Contract of carriage, receipt, document of title.", issuing: "Shipping Line / Carrier" },
            { type: "Commercial Invoice", purpose: "Details transaction for customs and payment.", issuing: "Exporter" },
        ];

        const shippingComparisonData = [
            { feature: "Minimum Volume", container: "Flexible (e.g., 20-2000 MT)", bulk: "Large (typically 6,000 MT+)" },
            { feature: "Cost Efficiency", container: "Higher per-tonne for large volumes", bulk: "More cost-efficient for large volumes" },
            { feature: "Loading Process", container: "Transloaded from railcars to containers", bulk: "Directly into vessel holds" },
            { feature: "Product Protection", container: "Liner bags, sealed environment", bulk: "Relies on hold cleanliness, ventilation" },
            { feature: "Flexibility & Destination", container: "Can reach more inland destinations", bulk: "Typically port-to-port" },
            { feature: "Typical Use Case (SK-PHL)", container: "Higher-value, identity-preserved, smaller lots", bulk: "Standard commodity grains" },
        ];


        function populateLogisticsSidebar() {
            logisticsSteps.forEach(step => {
                const item = document.createElement('a');
                item.href = "#";
                item.textContent = `${step.title}`;
                item.setAttribute('data-step-id', step.id);
                item.classList.add('sidebar-item', 'block', 'px-3', 'py-2', 'rounded-md', 'text-sm', 'font-medium', 'text-[#8B4513]', 'hover:bg-[#F5DEB3]', 'hover:text-[#8B4513]', 'transition-colors', 'duration-150');
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    document.querySelectorAll('.sidebar-item').forEach(el => el.classList.remove('sidebar-item-active'));
                    item.classList.add('sidebar-item-active');
                });
                logisticsSidebarContent.appendChild(item);
            });
        }

        function populateProducts() {
            const productsList = document.getElementById('products-list');
            productsData.forEach(product => {
                const productCard = `
                    <div class="bg-[#F5DEB3] p-4 rounded-lg shadow hover:shadow-xl transition-shadow duration-200">
                        <img src="${product.image}" alt="${product.name}" class="w-full h-40 object-cover rounded-md mb-3">
                        <h3 class="text-lg font-semibold text-[#8B4513]">${product.name}</h3>
                        <p class="text-sm text-[#A0522D] mt-1">${product.description}</p>
                    </div>
                `;
                productsList.innerHTML += productCard;
            });
        }
        
        function populateTable(tableId, data, columns) {
            const tableElement = document.getElementById(tableId);
            if (!tableElement) {
                return;
            }
            const tableBody = tableElement.querySelector('tbody');
            if (!tableBody) {
                return;
            }
            tableBody.innerHTML = ''; 
            data.forEach((row, index) => {
                const tr = document.createElement('tr');
                tr.classList.add(index % 2 === 0 ? 'table-row-even' : 'table-row-odd');
                columns.forEach(column => {
                    const td = document.createElement('td');
                    td.className = 'px-4 py-2 whitespace-nowrap text-sm text-gray-700';
                    td.textContent = row[column.key];
                    tr.appendChild(td);
                });
                tableBody.appendChild(tr);
            });
        }


        function renderQualityChart() {
            const ctx = document.getElementById('qualityChart')?.getContext('2d');
            if (!ctx) return;

            const wheatData = qualitySpecsData.filter(d => d.grain.includes("Wheat"));
            const labels = wheatData.filter(d => d.parameter === "Protein Content (dry basis)").map(d => d.grain);
            const proteinData = wheatData.filter(d => d.parameter === "Protein Content (dry basis)").map(d => parseFloat(d.target.match(/(\d+(\.\d+)?)/)[0]));


            if (qualityChartInstance) {
                qualityChartInstance.destroy();
            }

            qualityChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Min. Protein Content (%)',
                        data: proteinData,
                        backgroundColor: ['#006400', '#808000'], 
                        borderColor: ['#004d00', '#666600'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Protein Content (%)', color: '#8B4513' },
                            ticks: { color: '#A0522D' }
                        },
                        x: {
                            ticks: { color: '#A0522D', 
                                callback: function(value, index, values) {
                                    let label = this.getLabelForValue(value);
                                    if (label.length > 16) { 
                                        return label.match(/.{1,16}/g);
                                    }
                                    return label;
                                }
                            }
                        }
                    },
                    plugins: {
                        legend: { display: true, labels: { color: '#8B4513'} },
                        tooltip: {
                            backgroundColor: '#8B4513',
                            titleColor: '#F5DEB3',
                            bodyColor: '#FFFFFF',
                        }
                    }
                }
            });
        }
        
        function setActiveTab(tabId) {
            tabs.forEach(tab => {
                const isCurrentTab = tab.dataset.tab === tabId;
                tab.classList.toggle('tab-active', isCurrentTab);
                tab.classList.toggle('tab-inactive', !isCurrentTab);
            });

            tabContents.forEach(content => {
                content.classList.toggle('hidden', content.id !== `${tabId}-content`);
            });

            logisticsSidebar.classList.toggle('hidden', tabId !== 'logistics');
            logisticsSidebar.classList.toggle('flex', tabId === 'logistics'); 

            if (tabId === 'quality' && document.getElementById('qualityChart')) {
                 setTimeout(renderQualityChart, 0); 
            }
             if (tabId !== 'logistics') {
                geminiResultDiv.innerHTML = ''; 
                geminiResultDiv.classList.add('hidden');
                geminiLoadingDiv.classList.add('hidden');
            } else {
                 geminiResultDiv.classList.toggle('hidden', !geminiResultDiv.innerHTML.trim());
            }
        }

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                setActiveTab(tab.dataset.tab);
            });
        });
        
        document.getElementById('contactForm')?.addEventListener('submit', function(event) {
            event.preventDefault();
            const feedbackDiv = document.getElementById('form-feedback');
            feedbackDiv.textContent = 'Thank you for your message! We will get back to you shortly.';
            feedbackDiv.className = 'mt-3 text-sm text-green-700';
            this.reset();
            setTimeout(() => { feedbackDiv.textContent = ''; }, 5000);
        });

        async function fetchLogisticsAnalysis() {
            geminiLoadingDiv.classList.remove('hidden');
            geminiResultDiv.classList.add('hidden');
            geminiResultDiv.innerHTML = '';

            const prompt = "Analyze the key logistical risks and suggest innovative solutions for shipping grain (e.g., wheat, canola, barley) from Saskatchewan, Canada, to the Philippines. Consider factors such as: \n" +
                           "- Long-distance inland transportation to Canadian ports (e.g., rail, truck).\n" +
                           "- Port operations in Canada (e.g., Vancouver) including transloading, storage, and inspection.\n" +
                           "- Ocean freight challenges (e.g., container vs. bulk, transit times, weather).\n" +
                           "- Quality preservation during the entire journey (e.g., moisture, pests, temperature).\n" +
                           "- Regulatory hurdles and documentation for both export from Canada and import into the Philippines.\n" +
                           "- Potential disruptions (e.g., geopolitical, climate-related, infrastructure issues).\n" +
                           "Provide actionable insights and practical solutions. Format the response with clear headings for risks and solutions.";

            let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
            const payload = { contents: chatHistory };
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(`API Error: ${response.status} ${response.statusText}. Details: ${JSON.stringify(errorData)}`);
                }

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    let text = result.candidates[0].content.parts[0].text;
                    // Basic Markdown to HTML conversion for paragraphs and lists
                    text = text.replace(/\n\n/g, '</p><p class="mt-2">');
                    text = text.replace(/\n\*(.+)/g, '</li><li class="ml-4">$1');
                    text = text.replace(/<\/li><li class="ml-4">/g, '<li class="ml-4">'); // fix first item
                    text = text.replace(/(\*\*|__)(.*?)\1/g, '<strong>$2</strong>'); // Bold
                     // Handle headings (e.g., ## Heading) - basic version
                    text = text.replace(/^###\s*(.+)$/gm, '<h4 class="text-lg font-semibold text-[#8B4513] mt-3">$1</h4>');
                    text = text.replace(/^##\s*(.+)$/gm, '<h3 class="text-xl font-semibold text-[#8B4513] mt-4">$1</h3>');
                    text = text.replace(/^#\s*(.+)$/gm, '<h2 class="text-2xl font-semibold text-[#8B4513] mt-6">$1</h2>');


                    if (text.includes('<li class="ml-4">')) {
                         text = '<p class="mt-2">' + text.replace(/<li class="ml-4">/,'<ul class="list-disc list-inside space-y-1 mt-1"><li class="ml-4">') + '</ul></p>';
                    } else {
                        text = '<p class="mt-2">' + text + '</p>';
                    }
                    
                    geminiResultDiv.innerHTML = text;
                    geminiResultDiv.classList.remove('hidden');
                } else {
                    geminiResultDiv.innerHTML = '<p>No analysis received from the AI. The response structure might be unexpected.</p>';
                    geminiResultDiv.classList.remove('hidden');
                }
            } catch (error) {
                // console.error("Error fetching logistics analysis:", error);
                geminiResultDiv.innerHTML = `<p class="text-red-600">Error fetching analysis: ${error.message}. Please check the console for more details.</p>`;
                geminiResultDiv.classList.remove('hidden');
            } finally {
                geminiLoadingDiv.classList.add('hidden');
            }
        }

        analyzeShipmentButton.addEventListener('click', fetchLogisticsAnalysis);


        document.addEventListener('DOMContentLoaded', () => {
            populateLogisticsSidebar();
            populateProducts();
            populateTable('quality-specs-table', qualitySpecsData, [
                { key: 'grain', label: 'Grain Type' },
                { key: 'parameter', label: 'Key Parameter' },
                { key: 'target', label: 'Target Range / Grade Standard' }
            ]);
            populateTable('export-docs-table', exportDocsData, [
                { key: 'type', label: 'Document Type' },
                { key: 'purpose', label: 'Purpose/Requirement' },
                { key: 'issuing', label: 'Issuing Body/Responsibility' }
            ]);
             populateTable('logistics-comparison-table', shippingComparisonData, [
                { key: 'feature', label: 'Feature' },
                { key: 'container', label: 'Container Shipping' },
                { key: 'bulk', label: 'Bulk Vessel Shipping' }
            ]);

            setActiveTab('logistics'); 
            logisticsSidebarTitle.classList.add('font-extrabold'); 
        });

    </script>
</body>
</html>
